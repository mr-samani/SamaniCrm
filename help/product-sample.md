

# مثال عملی و ساده: فروشگاه چندشرکتی

فرض کن یک پلتفرم داریم که شرکت‌ها ثبت‌نام می‌کنند و محصولات خودشون رو می‌فروشند.

---

## شرکت (Tenant)

یک شرکت مثلا «شرکت الف» در سیستم ثبت‌نام کرده:

| Tenant.Id    | Tenant.Name | Tenant.Slug  | CreatedAt           | IsActive |
| ------------ | ----------- | ------------ | ------------------- | -------- |
| 11111111-... | شرکت الف    | sherkat-alef | 2024-01-01 12:00:00 | true     |

---

## دسته‌بندی‌ها (ProductCategory)

شرکت الف دو دسته اصلی تعریف می‌کند:

| Id           | TenantId     | ParentId | Name   | Slug   | Description | SortOrder | IsActive | CreatedAt           |
| ------------ | ------------ | -------- | ------ | ------ | ----------- | --------- | -------- | ------------------- |
| 22222222-... | 11111111-... | null     | موبایل | mobile | دسته موبایل | 1         | true     | 2024-01-02 10:00:00 |
| 33333333-... | 11111111-... | null     | لپ‌تاپ | laptop | دسته لپ‌تاپ | 2         | true     | 2024-01-02 10:05:00 |

---

## نوع محصول (ProductType)

شرکت الف یک نوع محصول تعریف می‌کند که «گوشی موبایل» است با ویژگی‌هایی:

* رنگ (رشته)
* حافظه (عدد)
* دارای گارانتی (بولین)

| Id           | TenantId     | Name        | Description     |
| ------------ | ------------ | ----------- | --------------- |
| 44444444-... | 11111111-... | گوشی موبایل | نوع گوشی موبایل |

---

## ویژگی‌های نوع محصول (ProductAttribute)

| Id           | ProductTypeId | Name             | DataType | IsRequired | IsVariant | SortOrder |
| ------------ | ------------- | ---------------- | -------- | ---------- | --------- | --------- |
| 55555555-... | 44444444-...  | رنگ              | string   | true       | true      | 1         |
| 66666666-... | 44444444-...  | حافظه (گیگابایت) | int      | true       | true      | 2         |
| 77777777-... | 44444444-...  | گارانتی          | bool     | false      | false     | 3         |

---

## محصول (Product)

شرکت الف یک محصول به نام «آیفون 14» در دسته موبایل ثبت می‌کند:

| Id           | TenantId     | CategoryId   | ProductTypeId | SKU     | Title        | Slug          | Description         | IsActive | CreatedAt           |
| ------------ | ------------ | ------------ | ------------- | ------- | ------------ | ------------- | ------------------- | -------- | ------------------- |
| 88888888-... | 11111111-... | 22222222-... | 44444444-...  | IP14PRO | آیفون 14 پرو | iphone-14-pro | گوشی آیفون سری جدید | true     | 2024-01-05 14:00:00 |

---

## مقادیر ویژگی‌ها (ProductAttributeValue)

برای محصول آیفون 14 مقادیر ویژگی‌ها را ثبت می‌کنیم:

| Id           | ProductId    | AttributeId  | Value |
| ------------ | ------------ | ------------ | ----- |
| 99999999-... | 88888888-... | 55555555-... | مشکی  |
| AAAAAAAA-... | 88888888-... | 66666666-... | 256   |
| BBBBBBBB-... | 88888888-... | 77777777-... | true  |

---

## واریانت‌ها (ProductVariant)

برای محصول «آیفون 14» دو واریانت داریم:

| Id           | ProductId    | SKU            | Price    | Stock | IsActive | CreatedAt           |
| ------------ | ------------ | -------------- | -------- | ----- | -------- | ------------------- |
| CCCCCCCC-... | 88888888-... | IP14PRO-BLK256 | 35000000 | 100   | true     | 2024-01-06 10:00:00 |
| DDDDDDDD-... | 88888888-... | IP14PRO-WHT256 | 35500000 | 50    | true     | 2024-01-06 10:10:00 |

---

## قیمت‌های واریانت‌ها (ProductPrice)

قیمت واریانت‌ها ممکن است با زمان یا منطقه تغییر کند:

| Id           | ProductVariantId | Currency | Price    | StartDate           | EndDate |
| ------------ | ---------------- | -------- | -------- | ------------------- | ------- |
| EEEEEEEE-... | CCCCCCCC-...     | IRR      | 35000000 | 2024-01-06 10:00:00 | null    |
| FFFFFFFF-... | DDDDDDDD-...     | IRR      | 35500000 | 2024-01-06 10:10:00 | null    |

---

## موجودی انبار (ProductInventory)

فرض کن یک انبار مرکزی داریم و موجودی هر واریانت ثبت شده:

| Id           | ProductVariantId | Quantity | WarehouseId | LastUpdated         |
| ------------ | ---------------- | -------- | ----------- | ------------------- |
| 11111111-... | CCCCCCCC-...     | 100      | 1234        | 2024-01-06 15:00:00 |
| 22222222-... | DDDDDDDD-...     | 50       | 1234        | 2024-01-06 15:10:00 |

---

## فایل‌های محصول (ProductFile)

اگر محصول فایل دیجیتال داشته باشد مثلا کتاب الکترونیکی:

| Id           | ProductId    | FileUrl                                                                | FileType |
| ------------ | ------------ | ---------------------------------------------------------------------- | -------- |
| 33333333-... | 88888888-... | [https://cdn.example.com/ebook.pdf](https://cdn.example.com/ebook.pdf) | pdf      |

---

# جمع‌بندی نحوه کارکرد سیستم:

1. شرکت‌ها (Tenant) محصول و دسته‌بندی خودشان را دارند و هر داده ای به Tenant مربوط است.
2. هر محصول یک نوع (ProductType) دارد که تعیین می‌کند چه ویژگی‌هایی دارد.
3. ویژگی‌های محصول به صورت داینامیک و قابل گسترش تعریف می‌شوند (مثل رنگ، حافظه، گارانتی).
4. هر محصول می‌تواند چند واریانت داشته باشد که قیمت و موجودی متفاوت دارند.
5. قیمت‌ها می‌توانند تاریخی و منطقه‌ای (Currency) باشند.
6. موجودی هر واریانت در انبار یا انبارهای مختلف رصد می‌شود.
7. فایل‌های مربوط به محصول (مثل نرم‌افزار یا کتاب) در جداول جداگانه مدیریت می‌شود.

---

اگر بخواهی، می‌تونم روی پیاده‌سازی بخش‌های خاص (مثل CQRS برای ثبت محصول، یا API طراحی‌شده) هم راهنمایی کنم یا حتی کد نمونه بدم.

حالا بگو دوست داری کد Entity+Mapping کامل یا موارد دیگر را بفرستم؟
