<h2 mat-dialog-title cdkDrag cdkDragRootElement=".cdk-overlay-pane">
  <span cdkDragHandle class="title">
    {{ (isEditMode ? 'EditExternalProvider' : 'NewExternalProviderOpenIDConnect') | translate }}
  </span>

  <button type="button" class="close-btn" aria-label="Close" mat-dialog-close mat-icon-button>
    <span aria-hidden="true">&times;</span>
  </button>
</h2>
<mat-dialog-content>
  <form [formGroup]="form" class="provider-form">
    <!-- Basic Information -->
    <h3>{{ 'BaseInfo' | translate }}</h3>
    <div class="row">
      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>{{ 'Name' | translate }}</mat-label>
        <input matInput formControlName="name" placeholder="example: MyCompanyOIDC" />
        <mat-hint>{{ 'UniqueProviderNameForIdentify' }}</mat-hint>
        @if (form.get('name')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('Name' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>{{ 'DisplayName' | translate }}</mat-label>
        <input matInput formControlName="displayName" placeholder="example: login with company auth" />
        @if (form.get('displayName')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('DisplayName' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>{{ 'Scheme' | translate }} ({{ 'Optional' | translate }})</mat-label>
        <input matInput formControlName="scheme" placeholder="If the name is empty, it will not be used" />
        <mat-hint>UniqueSchemeForAuthenticationHandler</mat-hint>
      </mat-form-field>

      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>{{ 'ProviderType' | translate }}</mat-label>
        <mat-select formControlName="providerType">
          @for (type of providerTypes; track type) {
            <mat-option [value]="type.value">
              {{ type.label }}
            </mat-option>
          }
        </mat-select>
        <mat-hint>{{ 'TypeOfIdentificationProtocol' | translate }}</mat-hint>
      </mat-form-field>
    </div>

    <!-- Client Credentials -->
    <h3>Client Credentials</h3>
    <div class="row">
      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>Client ID</mat-label>
        <input matInput formControlName="clientId" placeholder="client_id از provider" />
        <mat-hint>Client ID</mat-hint>
        @if (form.get('clientId')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('Client ID' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>Client Secret</mat-label>
        <input
          matInput
          [type]="showClientSecret ? 'text' : 'password'"
          formControlName="clientSecret"
          placeholder="client_secret از provider"
          autocomplete="off" />
        <button mat-icon-button matSuffix type="button" (click)="toggleClientSecretVisibility()">
          <i class="fa" [class.fa-eye]="!showClientSecret"></i>
          <i class="fa" [class.fa-eye-slash]="showClientSecret"></i>
        </button>
        <mat-hint>
          {{
            (isEditMode ? 'ForThisReason,ThereIsAnEmptyPresetAmount' : 'ClientSecretRecivedFromProvider') | translate
          }}
        </mat-hint>
        @if (form.get('clientSecret')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: 'Client Secret' } }}</mat-error>
        }
      </mat-form-field>
    </div>

    <!-- Endpoints -->
    <h3>(Endpoints)</h3>
    <div class="row">
      <mat-form-field class="col-sm-12">
        <mat-label>Authorization Endpoint</mat-label>
        <input
          matInput
          dir="ltr"
          formControlName="authorizationEndpoint"
          placeholder="https://provider.com/oauth/authorize" />
        <mat-hint>{{ 'LoginPageUrl' | translate }}</mat-hint>
        @if (form.get('authorizationEndpoint')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('LoginPageUrl' | translate) } }}</mat-error>
        }
        @if (form.get('authorizationEndpoint')?.hasError('pattern')) {
          <mat-error>{{ 'IsInvalid' | translate: { value: ('Description' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-12">
        <mat-label>Token Endpoint</mat-label>
        <input matInput dir="ltr" formControlName="tokenEndpoint" placeholder="https://provider.com/oauth/token" />
        <mat-hint>{{ 'ReciveTokenUrl' | translate }}</mat-hint>
        @if (form.get('tokenEndpoint')?.hasError('ReciveTokenUrl')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('ReciveTokenUrl' | translate) } }}</mat-error>
        }
        @if (form.get('tokenEndpoint')?.hasError('pattern')) {
          <mat-error>{{ 'IsInvalid' | translate: { value: ('ReciveTokenUrl' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-12">
        <mat-label>UserInfo Endpoint</mat-label>
        <input
          matInput
          dir="ltr"
          formControlName="userInfoEndpoint"
          placeholder="https://provider.com/oauth/userinfo" />
        <mat-hint>{{ 'UserInfoUrl' | translate }}</mat-hint>
        @if (form.get('userInfoEndpoint')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('UserInfoUrl' | translate) } }}</mat-error>
        }
        @if (form.get('userInfoEndpoint')?.hasError('pattern')) {
          <mat-error>{{ 'IsInvalid' | translate: { value: ('UserInfoUrl' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-12">
        <mat-label>{{ 'LogoutUrl' | translate }} ({{ 'Optional' | translate }})</mat-label>
        <input matInput dir="ltr" formControlName="logoutEndpoint" placeholder="https://provider.com/oauth/logout" />
        @if (form.get('logoutEndpoint')?.hasError('pattern')) {
          <mat-error>{{ 'IsInvalid' | translate: { value: ('LogoutUrl' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-12">
        <mat-label>Callback Path ({{ 'Optional' | translate }})</mat-label>
        <input matInput dir="ltr" formControlName="callbackPath" placeholder="/signin-oidc" />
        <mat-hint>{{ 'GeneratedAutoIfEmpty' | translate }}</mat-hint>
      </mat-form-field>
    </div>

    <!-- OAuth/OIDC Settings -->
    <h3>OAuth/OIDC settings</h3>
    <div class="row">
      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>Scopes</mat-label>
        <input matInput formControlName="scopes" placeholder="openid profile email" />
        <mat-hint>Reqiorement Scopes (seperate with space or comma)</mat-hint>
        @if (form.get('scopes')?.hasError('required')) {
          <mat-error>{{ 'IsRequired' | translate: { value: ('Description' | translate) } }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>{{ 'ResponseType' | translate }}</mat-label>
        <mat-select formControlName="responseType">
          @for (type of responseTypes; track type) {
            <mat-option [value]="type.value">
              {{ type.label }}
            </mat-option>
          }
        </mat-select>
        <mat-hint>{{ 'UsedFlowType' | translate }}</mat-hint>
      </mat-form-field>

      <mat-form-field class="col-sm-6 col-md-4">
        <mat-label>{{ 'ResponseMode' | translate }}</mat-label>
        <mat-select formControlName="responseMode">
          @for (mode of responseModes; track mode) {
            <mat-option [value]="mode.value">
              {{ mode.label }}
            </mat-option>
          }
        </mat-select>
        <mat-hint>{{ 'HowToReturnResponse' | translate }}</mat-hint>
      </mat-form-field>
    </div>
    <p class="checkbox-field">
      <mat-checkbox formControlName="usePkce">{{ 'UsingPKCE(ProofKeyforCodeExchange)' | translate }}</mat-checkbox>
      <span class="hint-text">{{ 'IsRecommendedForGreaterSecurity' | translate }}</span>
    </p>
    <!-- Advanced Settings -->
    <h3>{{ 'AdvancedSetting' | translate }}({{ 'Optional' | translate }})</h3>
    <div class="row">
      <mat-form-field class="col-sm-12">
        <mat-label>Metadata JSON</mat-label>
        <textarea
          matInput
          formControlName="metadataJson"
          rows="4"
          placeholder='{"claim_mapping": {"email": "mail"}}'></textarea>
        <mat-hint>JSON settings for mapping or other things</mat-hint>
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>
<mat-dialog-actions>
  <button mat-button mat-dialog-close color="cancel">{{ 'Cancel' | translate }}</button>
  <button mat-raised-button color="primary" (click)="onSubmit()" cdkFocusInitial [disabled]="loading || saving">
    @if (saving) {
      <mat-spinner color="primary" diameter="25"></mat-spinner>
    }
    <span>{{ 'Save' | translate }}</span>
  </button>
</mat-dialog-actions>
