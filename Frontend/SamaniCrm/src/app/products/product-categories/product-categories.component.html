<div class="tools d-flex justify-content-end align-items-center flex-wrap gap-2">
  <div class="d-flex gap-2">
    <button
      mat-raised-button
      color="primary"
      (click)="openCreateOrEditDialog()"
      *ngIf="AppPermissions.Products_Category_Create | permission">
      <i class="fa fa-circle-plus mx-1"></i>
      <span>{{ 'CreateNewCategory' | translate }}</span>
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="exportAllLocalizations()"
      *ngIf="AppPermissions.Products_Category_Export | permission">
      <i class="fa fa-circle-plus mx-1"></i>
      <span>{{ 'ExportAllLocalizations' | translate }}</span>
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="importLocalizations()"
      *ngIf="AppPermissions.Products_Category_Import | permission">
      <i class="fa fa-circle-plus mx-1"></i>
      <span>{{ 'ImportAllLocalizations' | translate }}</span>
    </button>
  </div>
</div>

<div class="d-flex align-items-center justify-content-center py-5" *ngIf="loading">
  <mat-spinner diameter="30" color="primary"></mat-spinner>
</div>
<div class="tree">
  <ng-container *ngTemplateOutlet="categoryTemplate; context: { $implicit: list }"></ng-container>
</div>

<ng-template #categoryTemplate let-list>
  <ul>
    <li
      *ngFor="let item of list; let i = index"
      class="node"
      [class.close-child]="!item.isOpen"
      [class.last]="i == list.length - 1">
      <div class="inner">
        <span
          class="tree-icon"
          [class.isOpen]="item.isOpen"
          [class.no-child]="!item.hasChildren && (!item.children || item.children.length == 0)"
          (click)="openCloseFolder(item)"></span>

        <span
          [class.icon-folder]="!item.isOpen && item.hasChildren"
          [class.icon-folder-open]="item.isOpen && item.hasChildren"
          [class.icon-file]="!item.hasChildren"></span>

        <div class="checkbox-container" (click)="onChange(item)">
          <span
            class="checkbox"
            [class.checked]="item.isActive"
            [class.indeterminate]="item.hasUnSelectedChildren"
            [class.squre]="item.isActive && item.hasUnSelectedChildren"></span>
          <img *ngIf="item.image" [src]="baseUrl + '/' + item.image" class="img-circle" />
          <img *ngIf="!item.image" src="/images/default-image.png" class="img-circle img-cover" />
          <button type="button" (click)="remove(item)" class="btn btn-icon">
            <i class="fa fa-trash"></i>
          </button>
          <button type="button" (click)="openCreateOrEditDialog(item)" class="btn btn-icon">
            <i class="fa fa-edit"></i>
          </button>
          <span [title]="item.description">{{ item.title }}</span>
        </div>
      </div>

      @if (item.children) {
        <ng-container *ngTemplateOutlet="categoryTemplate; context: { $implicit: item.children }"></ng-container>
      }
    </li>
  </ul>
</ng-template>
